<h1>Spiffy UI Authentication</h1>
<div id="authPanelText" class="documentationPanel">
    <p>
        The Spiffy UI framework comes with a built-in authentication mechanism, which can be overridden by your own.
        You can see it in action by clicking the "Login & Get Data" button below.
        <p><div id="testAuth"></div>
        <p><div id="testAuthResult"></div>
    </p>

    <h2>Authentication Process</h2>
    <p>
        REST is stateless. Any client request to a server URL that requires authentication will need to carry an authentication token.
    </p>

    <p>1. Client makes a request to server url http://host:post/data-server-war-context/path-require-auth in order to access some resources.</p>

    <p>2. Server looks for specific authentication header, since it is not found, it returns back JSON indicating no authentication information available.
        It will also send back WWW-Authenticate response header, with authentication server url information, letting client know to authenticate.</p>
        <p>
    <pre>WWW-Authenticate  X-OPAQUE uri="http://host2:port2/auth-server-war-context/auth-path", signOffUri=""</pre>
    <p>

    <p>3. Due to same origin policy, client can not directly contact the authentication server which is on a different server.
        So client contacts a servlet (AuthServlet) that is in the same client war, forwarding on user credentials.
        The servlet, which acts as a proxy, then contacts the authentication server at http://host2:port2/auth-server-war-context/auth-path to ask for
        authentication token to access data server resources. To use the proxy servlet, it must be added to the web.xml of the client war.</p>
      <p>
      <pre>
        &lt;servlet&gt;
          &lt;servlet-name&gt;AuthServlet&lt;/servlet-name&gt;
          &lt;servlet-class&gt;com.novell.spiffyui.server.AuthServlet&lt;/servlet-class&gt;
        &lt;/servlet&gt;

        &lt;servlet-mapping&gt;
          &lt;servlet-name&gt;AuthServlet&lt;/servlet-name&gt;
          &lt;url-pattern&gt;/auth/*&lt;/url-pattern&gt;
        &lt;/servlet-mapping&gt;
      </pre>

    <p>4. If user's credentials is sufficient, authentication server will return back an authentication token in JSON format, such as:</p>
    <p>
    <pre>{"Token":"demouser"} </pre>
    <p>
    <p> to the proxy servlet, which then forwards the token back to client to be saved in browser cookie.</p>

    <p>5. Client can now make the request to access the resources again on the data server at original url:  http://host:post/data-server-war-context/path-require-auth,
        carrying authentication token in request header "Authorization":
    <p>
    <pre> Authorization	X-OPAQUE demouser </pre>
    <p>

    <p>6. Data server checks and validates the authentication token, then returns back requested resources.</p>

    <h2>Login example explained</h2>
    <p>Here is what happens when you click the "Login & Get Data" button.</p>

    <p>1. Browser sends "GET" request to http://localhost:8081/spsample/authdata (implemented by SampleDataServlet).</p>

    <p>2. Server returns Unauthorized with NoAuthHeader fault payload, and WWW-Authenticate response header
X-OPAQUE uri="http://localhost:8081/spsample/authserver", signOffUri=""</p>

    <p>3. Browser shows Login Panel, prompting user for credentials user name and password. </p>

    <p>4. User enters user name and password (any string would be fine), upon submit,
        brower contacts proxy server AuthServlet at http://localhost:8081/spsample/auth, forwarding on user credentials.</p>

    <p>5. Proxy server AuthServlet contacts authentication server (implemented by SampleAuthServer)
        at http://localhost:8081/spsample/authserver to ask for authentication token.</p>

    <p>6. Authentication server grants authentication token for any user credentials received, and returns back authentication token: {"Token":username}.  </p>

    <p>7. Proxy server sends the authentication token back to browser, which in trun is saved in browser cookie.</p>

    <p>8. Original url  http://localhost:8081/spsample/authdata is requested again, carrying authentication token (got from browser cookie) in request header "Authorization".</p>

    <p>9. Server returns back data.</p>   

</div>

